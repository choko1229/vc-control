# 🎧 Discord VC Notification Bot

Discordサーバー内のボイスチャンネル(VC)の状態を監視し、  
**入退室通知・メンションDM通知・VC開始/終了サマリ通知** を自動で行う多機能Botです。

---

## 🚀 主な機能

### 🎙 VC入退室通知
- 各VCのテキスト欄にEmbed形式で入退室を自動通知  
- デザイン：
  - 入室 → 緑色（`0x2ECC71`）
  - 退室 → 赤色（`0xE74C3C`）  
- ユーザーの表示名・アイコンを表示  
- 例：
  ```
  {ユーザー名} がボイスチャンネルに接続しました。
  ```

---

### 📢 VC開始・終了サマリ通知（通知チャンネル機能）
- `NOTICE_CHANNEL_ID` で指定したチャンネルに、VCの開始／終了情報をEmbed送信

#### ✅ VC開始（最初の入室時）
- 緑色Embed
- タイトル：`{ユーザー}がVCを開始しました。`
- 内容：
  ```
  VC開始時刻：{何月何日 17:00} (<t:UNIXTIME:R>)
  ```
- 送信者アイコン付き  

#### 🔴 VC終了（最後の退出時）
- 前回の「開始」Embedを削除し、新たに赤色Embedで通知
- 内容：
  ```
  VC開始時刻：{開始時間}
  VC終了時刻：{終了時間}
  VC継続時間：{何時間何分何秒}
  参加したユーザー：
    - ユーザーA（参加時間: 1時間12分30秒）
    - ユーザーB（参加時間: 25分30秒）
  ```
- 参加時間は入退室を複数回繰り返しても自動で累積計算

---

### 💬 VCテキストでの @メンション → DM通知
- VCのテキストメッセージ欄でユーザーをメンションすると、自動的にDMを送信
- DM内容：
  - タイトル：`🔔 {メンションしたユーザー}がVCであなたを呼んでいます。`
  - 本文：`{VC名} であなたをメンションしました。`
  - メッセージ内容（メンション以外の本文がある場合）
  - メッセージへのジャンプリンク  
- `@everyone` / `@here` はDM送信されず、VCに警告メッセージを表示

---

### 🕒 無人VCの自動削除
- 誰もいなくなったVCを一定時間後に自動削除  
- デフォルト：
  - 10秒後：「全員が退出しました」通知
  - さらに20秒後：チャンネル削除  

---

## 🧠 技術仕様

| 機能 | イベント | 送信先 | 色 | 内容 |
|------|-----------|--------|----|------|
| 入室通知 | `on_voice_state_update` | VCテキスト欄 | 緑 | {ユーザー}が接続しました。 |
| 退室通知 | `on_voice_state_update` | VCテキスト欄 | 赤 | {ユーザー}が切断しました。 |
| VC開始 | 最初の入室時 | 通知チャンネル | 緑 | 開始時刻＋相対時刻表示 |
| VC終了 | 最後の退出時 | 通知チャンネル | 赤 | 開始/終了/継続時間＋参加者一覧 |
| メンションDM | `on_message` | DM | 青 | メンション情報＋リンク |
| 無人削除 | 一定時間後 | - | - | VC削除 |

---

## 🧩 実装構成

- **Python 3.10+**（Python 3.13 では標準ライブラリの `audioop` が削除されたため、本リポジトリ同梱の互換モジュールで動作します）
- **Pycord 2.x**
- `settings.json` に各種IDとトークンを指定
- Embedベース通知（タイトル／説明／アイコン／相対時刻対応）
- JST(日本標準時)および `<t:UNIXTIME:R>` 相対時刻表記対応
- メモリ上でセッション管理（参加者ごとの入退室・滞在時間）

---

## 🧾 ライセンス
このソフトウェアは [MIT License](LICENSE) のもとで公開されています。

---

## ⚙️ セットアップ

1. `settings-template.json` を `settings.json` にコピーします。
2. 下記の値を埋めてください（すべて必須）。
   - `TOKEN`: Discord Bot のトークン
   - `BASE_VC_ID`: 基本となる待機VCのID
   - `VC_CATEGORY_ID`: VCをまとめるカテゴリのID
   - `NOTICE_CHANNEL_ID`: VC開始/終了サマリを投稿するテキストチャンネルID
   - `FIRST_EMPTY_NOTICE_SEC` / `FINAL_DELETE_SEC`: 無人VCの削除までの秒数
   - `DISCORD_CLIENT_ID` / `DISCORD_CLIENT_SECRET` / `DISCORD_REDIRECT_URI`: ダッシュボード用のDiscord OAuth2情報
   - `DASHBOARD_SESSION_SECRET`: ダッシュボードのセッション暗号化キー（適当なランダム文字列）
3. `settings.json` は秘匿情報のためリポジトリには含めないでください（`.gitignore` で除外済み）。

---

## 💡 今後の拡張予定
- セッション履歴の永続化（JSON / SQLite）
- 週ごとのVC利用統計レポート
- VC稼働ランキング機能
- Webダッシュボード連携
- 管理コマンド（例：`!vcstats`）

---

## 👤 作者
**choko1229**  
- Discord Bot開発 / サーバー自動化 / Webシステム構築  
- Website: [https://choko1229.net](https://choko1229.net)
